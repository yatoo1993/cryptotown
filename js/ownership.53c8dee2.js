(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ownership"],{e7b1:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ownership"},[n("div",{staticClass:"ownership-form"},[n("div",{staticClass:"title"},[t._v("置业信息")]),n("md-input-item",{attrs:{type:"number",placeholder:"当前排最多可以购买"+t.block_buy_limit+"地块"},model:{value:t.order_number,callback:function(e){t.order_number=e},expression:"order_number"}},[n("span",{attrs:{slot:"right"},slot:"right"},[t._v("*"+t._s(t.setting.block_price.value)+"USDT")])]),n("div",{staticClass:"fee flex-row"},[n("span",[t._v("手续费："+t._s(t.fee)+"排单币")]),n("span",[t._v("实际消耗："+t._s(t.give)+"USDT")])]),n("div",{staticClass:"submit-btn"},[t.can_confirm||t.can_confirm_and_book?n("md-button",{attrs:{type:"primary",round:"",loading:t.luck},on:{click:t.checkOne}},[t._v("确定")]):t._e(),t.can_confirm_and_book?n("div",{staticClass:"change-ownership",on:{click:t.toogle}},[t._v("预约购买>")]):t._e(),t.can_book?n("md-button",{attrs:{type:"primary",round:"",loading:t.luck},on:{click:t.checkOne}},[t._v("预约购买")]):t._e()],1),n("div",{staticClass:"sub-title"},[t._v("置业说明")]),n("div",{staticClass:"content"},[t._v(" 1.每个用户最多购买当前排地块数量"+t._s(100*t.setting.block_buy_limit.value)+"%地块 "),n("br"),t._v(" 2.置业手续费为实际消耗总价的"+t._s(100*t.setting.block_buy_fee.value)+"%价值的排单币 "),n("br"),t._v("3.预约购买，每排地块出售完之后，下一排的地块 将于5天后开启，但可以提前预约购买，只能预约 购买下一排 ")])],1)])},s=[],r=(n("d3b7"),n("5530")),a=n("5880"),o={name:"ownership",data:function(){return{order_number:"",remainCells:null,remainFee:null,luck:!1}},computed:Object(r["a"])({},Object(a["mapState"])(["setting","userInfo"]),{},Object(a["mapGetters"])(["open_at","appointment_at","floor_id","cells"]),{can_book:function(){var t=Date.now();return t-this.appointment_at<0},can_confirm_and_book:function(){var t=Date.now();return t>this.appointment_at&&t<this.open_at},can_confirm:function(){var t=Date.now();return t-this.open_at>0},fee:function(){return 0===this.setting.tt_usdt_price.value?"":Math.floor(this.setting.block_buy_fee.value*this.order_number/this.setting.tt_usdt_price.value*this.setting.block_price.value*100)/100},give:function(){return this.order_number*this.setting.block_price.value},block_buy_limit:function(){return this.cells.length*this.setting.block_buy_limit.value}}),methods:Object(r["a"])({},Object(a["mapActions"])(["getHome","getSetting","paymentSetpOne","paymentSetpTwo","paymentSetpThree","paymentCancel"]),{toogle:function(){this.show_book=!0},checkOne:function(){var t=this;return window.web3?this.order_number?this.luck?void 0:(this.luck=!0,this.paymentSetpOne().then((function(e){var n=e.remainCells,i=e.remainFee;t.remainCells=n,t.remainFee=i,t.submit()})).catch((function(){return t.luck=!1}))):this.$toast.failed("请输入地块数量"):this.$toast.failed("非Dapp环境无法付款")},isPassOne:function(){return this.remainCells>this.order_number&&this.remainFee>this.fee},submit:function(){var t=this;if(this.isPassOne()){var e={floor_id:this.floor_id,order_number:this.order_number};this.paymentSetpTwo(e).then((function(e){t.sendPay(e.data)})).catch((function(){return t.luck=!1}))}else this.luck=!1,this.remainCells<this.order_number&&this.$toast.info("最多购买"+this.remainCells),this.remainFee<this.fee&&this.$toast.info("剩余手续费"+this.remainFee)},sendPay:function(t){var e=this;window.web3.eth.sendTransaction(Object(r["a"])({},t)).then((function(n){var i=n.transactionHash;e.paymentSetpThree({order_id:t.order_id,hash:i}).then((function(){e.$toast.succeed("交易成功")}))})).catch((function(n){e.paymentCancel({order_id:t.order_id}),e.$dialog.alert({content:n.message,confirmText:"确定"})})).finally((function(){return e.luck=!1}))}}),created:function(){this.getSetting(),this.getHome(!0)}},c=o,l=n("2877"),u=Object(l["a"])(c,i,s,!1,null,null,null);e["default"]=u.exports}}]);